# quickcopy

åŸºäºé™æ€ä»£ç ç”Ÿæˆçš„æ·±åº¦æ‹·è´å‡½æ•°ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒåŸºç¡€ç±»å‹ã€æ—¶é—´å’Œ UUID ç­‰ç±»å‹çš„è‡ªåŠ¨è½¬æ¢ã€‚

## ç‰¹æ€§

- ğŸš€ è‡ªåŠ¨ç”Ÿæˆç»“æ„ä½“é—´çš„æ·±åº¦æ‹·è´å‡½æ•°
- ğŸ’ª æ”¯æŒå¤šç§ç±»å‹è½¬æ¢ï¼š
  - int å’Œ string äº’è½¬
  - time.Time å’Œ string äº’è½¬
  - uuid.UUID å’Œ string äº’è½¬
  - int å’Œ int8/16/32/64 äº’è½¬
- ğŸ¯ ä½¿ç”¨ç®€å•ï¼Œä»…éœ€ä¸€è¡Œæ³¨é‡Šå³å¯ç”Ÿæˆ
- âš¡ åŸºäºé™æ€ä»£ç ç”Ÿæˆï¼Œè¿è¡Œæ—¶é›¶å¼€é”€

## åŠŸèƒ½è¯¦æƒ…

- **ç±»å‹è½¬æ¢é€»è¾‘**ï¼š
  - æ”¯æŒæ•´æ•°ç±»å‹å®½åº¦åˆ¤æ–­ï¼Œç¡®ä¿ç±»å‹è½¬æ¢çš„å®‰å…¨æ€§ã€‚
  - æä¾›ç±»å‹è½¬æ¢é€»è¾‘è·å–åŠŸèƒ½ï¼Œè‡ªåŠ¨å¤„ç†ä¸åŒç±»å‹é—´çš„è½¬æ¢ã€‚

- **çª„åŒ–è½¬æ¢**ï¼š
  - é»˜è®¤ä¸å…è®¸çª„åŒ–è½¬æ¢ï¼Œå¯é€šè¿‡ `--allow-narrow` é€‰é¡¹è¿›è¡Œé…ç½®ã€‚
  - `--allow-narrow` é€‰é¡¹å…è®¸åœ¨ç±»å‹è½¬æ¢æ—¶è¿›è¡Œçª„åŒ–ï¼Œä¾‹å¦‚ä» int64 åˆ° int32ã€‚

- **å¿½ç•¥å¤§å°å†™**ï¼š
  - é»˜è®¤æƒ…å†µä¸‹ï¼Œå­—æ®µåæ¯”è¾ƒåŒºåˆ†å¤§å°å†™ã€‚
  - å¯ä»¥é€šè¿‡ `--ignore-case` é€‰é¡¹æ¥å¿½ç•¥å­—æ®µåçš„å¤§å°å†™ï¼Œä½¿å¾—å­—æ®µåçš„åŒ¹é…ä¸åŒºåˆ†å¤§å°å†™ã€‚

- **å•ä¸ªå…ƒç´ ä¸æ•°ç»„è½¬æ¢**ï¼š
  - æ”¯æŒå°†å•ä¸ªå…ƒç´ èµ‹å€¼ç»™æ•°ç»„ï¼Œä»¥åŠä»æ•°ç»„ä¸­æå–å•ä¸ªå…ƒç´ è¿›è¡Œèµ‹å€¼ã€‚
  - å¯ä»¥é€šè¿‡ `--single-to-slice` é€‰é¡¹å¯ç”¨æ­¤åŠŸèƒ½ã€‚è¯¥é€‰é¡¹å…è®¸åœ¨æ‹·è´å‡½æ•°ä¸­å°†å•ä¸ªå…ƒç´ è½¬æ¢ä¸ºæ•°ç»„æˆ–ä»æ•°ç»„ä¸­æå–å•ä¸ªå…ƒç´ ã€‚

## å®‰è£…

### æ–¹å¼1ï¼šç›´æ¥å®‰è£…

```bash
go get github.com/antlabs/quickcopy/cmd/quickcopy
```

### æ–¹å¼2ï¼šä»æºç ç¼–è¯‘

```bash
git clone https://github.com/antlabs/quickcopy.git
cd quickcopy
make
```

## ä½¿ç”¨æ–¹æ³•

### æ­¥éª¤1ï¼šå®šä¹‰ç»“æ„ä½“

åœ¨ä½ çš„ä»£ç ä¸­å®šä¹‰æºç»“æ„ä½“å’Œç›®æ ‡ç»“æ„ä½“ï¼š

```go
// æºç»“æ„ä½“
type Source struct {
    Name     string
    Age      int
    Birthday time.Time
    ID       uuid.UUID
}

// ç›®æ ‡ç»“æ„ä½“
type Destination struct {
    Name     string
    Age      string    // æ”¯æŒç±»å‹è‡ªåŠ¨è½¬æ¢
    Birthday string    // time.Time å°†è‡ªåŠ¨è½¬ä¸º RFC3339 æ ¼å¼
    ID       string    // UUID å°†è‡ªåŠ¨è½¬ä¸ºå­—ç¬¦ä¸²
}
```

### æ­¥éª¤2ï¼šæ·»åŠ æ‹·è´å‡½æ•°åŸå‹å’Œæ³¨é‡Šæ ‡è®°

æ·»åŠ æ‹·è´å‡½æ•°åŸå‹å’Œæ³¨é‡Šæ ‡è®°ï¼š

```go
// :quickcopy
func CopyToDestination(dst *Destination, src *Source) {
}
```

### æ­¥éª¤3ï¼šè¿è¡Œå·¥å…·ç”Ÿæˆä»£ç 

è¿è¡Œå·¥å…·ç”Ÿæˆä»£ç ï¼š

```bash
quickcopy
```

å·¥å…·ä¼šè‡ªåŠ¨ç”Ÿæˆå¦‚ä¸‹æ‹·è´å‡½æ•°ï¼š

```go
// CopyToDestination æ˜¯ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„æ‹·è´å‡½æ•°
func CopyToDestination(dst *Destination, src *Source) {
    dst.Name = src.Name
    dst.Age = fmt.Sprint(src.Age)
    dst.Birthday = src.Birthday.Format(time.RFC3339)
    dst.ID = src.ID.String()
}
```

## ä½¿ç”¨ç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ quickcopy ç”Ÿæˆæ‹·è´å‡½æ•°çš„ç¤ºä¾‹ï¼š

```go
// è‡ªåŠ¨ç”Ÿæˆçš„æ‹·è´å‡½æ•°ç¤ºä¾‹
func CopyData(dst *Destination, src *Source) {
    dst.Name = src.Name
    dst.Age = strconv.Itoa(src.Age) // int è½¬ string
    dst.Birthday = src.Birthday.Format(time.RFC3339) // time.Time è½¬ string
    dst.ID = src.ID.String() // UUID è½¬ string
}
```

## é…ç½®é€‰é¡¹

- `AllowNarrowingConversion`ï¼š
  - ç±»å‹ï¼š`bool`
  - é»˜è®¤å€¼ï¼š`false`
  - æè¿°ï¼šæ˜¯å¦å…è®¸çª„åŒ–è½¬æ¢ã€‚

```go
// :quickcopy --allow-narrow
func NarrowCopy(dst *Destination, src *Source) {
    dst.Name = src.Name
    dst.Age = int8(src.Age) // çª„åŒ–è½¬æ¢ int åˆ° int8
    dst.Birthday = src.Birthday.Format(time.RFC3339)
    dst.ID = src.ID.String()
}
```

## æ”¯æŒçš„ç±»å‹è½¬æ¢

| æºç±»å‹ | ç›®æ ‡ç±»å‹ | è½¬æ¢æ–¹å¼ |
|--------|----------|----------|
| `int`          | `string`       | fmt.Sprint                        |
| `string`       | `int`          | strconv.Atoi                     |
| `time.Time`    | `string`       | Format(time.RFC3339)             |
| `string`       | `time.Time`    | Parse(time.RFC3339)              |
| `uuid.UUID`    | `string`       | UUID.String()                   |
| `string`       | `uuid.UUID`    | uuid.Parse                      |
| `int8`         | `int16`        | int16(i)                        |
| `int8`         | `int32`        | int32(i)                        |
| `int8`         | `int64`        | int64(i)                        |
| `int16`        | `int8`         | int8(i)                         |
| `int16`        | `int32`        | int32(i)                        |
| `int16`        | `int64`        | int64(i)                        |
| `int32`        | `int8`         | int8(i)                         |
| `int32`        | `int16`        | int16(i)                        |
| `int32`        | `int64`        | int64(i)                        |
| `int64`        | `int8`         | int8(i)                         |
| `int64`        | `int16`        | int16(i)                        |
| `int64`        | `int32`        | int32(i)                        |
| `[]int`        | `int`          | æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™å•ä¸ªæ•´æ•°     |
| `int`          | `[]int`        | å•ä¸ªæ•´æ•°èµ‹å€¼ç»™æ•°ç»„ï¼ˆå¦‚æœå¯ç”¨ï¼‰     |

## ä»£ç ç»“æ„æ¦‚è§ˆ

- **`CopyFuncInfo` ç»“æ„ä½“**ï¼šå­˜å‚¨æ‹·è´å‡½æ•°çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æºå’Œç›®æ ‡å˜é‡ã€ç±»å‹åŠå­—æ®µæ˜ å°„ã€‚
- **`FieldMapping` ç»“æ„ä½“**ï¼šå®šä¹‰å­—æ®µé—´çš„æ˜ å°„å…³ç³»å’Œè½¬æ¢é€»è¾‘ã€‚
- **ä¸»è¦åŠŸèƒ½å‡½æ•°**ï¼š
  - `generateCompleteCopyFunc`ï¼šç”Ÿæˆå®Œæ•´çš„æ‹·è´å‡½æ•°å¹¶æ›¿æ¢åŸå§‹å‡½æ•°ã€‚
  - `getFieldMappings`ï¼šè·å–å­—æ®µæ˜ å°„å…³ç³»ã€‚

## è‡ªå®šä¹‰æ‰©å±•

å¯ä»¥é€šè¿‡ä¿®æ”¹ä»¥ä¸‹å‡½æ•°æ¥è‡ªå®šä¹‰è½¬æ¢é€»è¾‘ï¼š

1. `getTypeConversion`: è‡ªå®šä¹‰ç±»å‹è½¬æ¢é€»è¾‘

## æ³¨æ„äº‹é¡¹

1. å¯¹äº string åˆ° int ç­‰å¯èƒ½å¤±è´¥çš„è½¬æ¢ï¼Œç”Ÿæˆçš„ä»£ç ä¼šé™é»˜å¤„ç†é”™è¯¯
2. æ—¶é—´ç±»å‹ç»Ÿä¸€ä½¿ç”¨ RFC3339 æ ¼å¼è¿›è¡Œè½¬æ¢
3. ç¡®ä¿ç›®æ ‡ç»“æ„ä½“å­—æ®µç±»å‹åœ¨æ”¯æŒçš„è½¬æ¢èŒƒå›´å†…

## å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

- ç¡®ä¿æ‰€æœ‰ä¾èµ–é¡¹å·²æ­£ç¡®å®‰è£…ã€‚
- éªŒè¯ Go ç¯å¢ƒè®¾ç½®æ˜¯å¦æ­£ç¡®ã€‚
- å‚è€ƒ GitHub é—®é¢˜é¡µé¢ä»¥è·å–å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚